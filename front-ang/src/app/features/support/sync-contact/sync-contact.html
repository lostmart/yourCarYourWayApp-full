<!-- Login Screen -->
<div *ngIf="!isConnected" class="login-container flex flex-col items-center justify-center gap-4">
  <!-- Chat Header (same as above) -->
  <div
    class="flex items-center justify-center p-4 bg-gradient-to-r from-indigo-600 to-blue-500 w-full mb-8"
  >
    <h3>Welcome You Direct Live Support</h3>
  </div>
  <h2 class="mt-8">Join Chat</h2>
  <input
    class="px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 w-[300px] focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent ng-untouched ng-pristine ng-invalid"
    type="text"
    [(ngModel)]="username"
    placeholder="Enter your name"
    (keyup.enter)="connect()"
    [disabled]="isConnecting"
  />
  <button
    (click)="connect()"
    [disabled]="isConnecting || !username.trim()"
    class="w-[300px] bg-primary-600 hover:bg-primary-700 text-white font-semibold py-4 rounded-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed"
  >
    {{ isConnecting ? 'Connecting...' : 'Join Chat' }}
  </button>
</div>

<!-- Chat Screen -->
<div
  *ngIf="isConnected"
  class="flex flex-col h-[calc(100vh-200px)] bg-gray-900 text-white rounded-lg shadow-2xl max-w-full mx-auto mb-8"
>
  <!-- Chat Header (same as above) -->

  <div class="flex items-center justify-between p-4 bg-gradient-to-r from-indigo-600 to-blue-500">
    <h3>Chat - {{ username }}</h3>
    <button
      class="bg-gray-800 hover:bg-gray-600 text-white font-semibold py-4 rounded-lg transition-all min-w-[100px] disabled:opacity-50 disabled:cursor-not-allowed"
      (click)="disconnect()"
    >
      Leave
    </button>
  </div>

  <div #chatContainer class="h-[calc(100vh-200px)] bg-gray-800 p-4 overflow-y-auto flex-1">
    <div
      *ngFor="let message of messages; trackBy: trackByMessageId"
      class="message"
      [class.user-message]="isUserMessage(message)"
      [class.bot-message]="!isUserMessage(message)"
      [class.system-message]="message.type !== 'CHAT'"
    >
      <ng-container *ngIf="message.type === 'CHAT'" class="flex items-end">
        <div class="flex-1 flex flex-col items-end">
          <div class="flex items-center space-x-2 mb-1">
            <span class="text-xs text-gray-500">{{ getMessageTime(message.timestamp) }}</span>
            <span class="text-sm font-semibold text-gray-300">{{ message.sender }}</span>
          </div>
          <div class="flex flex-row items-center space-x-3">
            <div class="bg-indigo-600 rounded-2xl rounded-tr-none p-3 max-w-xs">
              <p class="text-sm text-white">{{ message.content }}</p>
            </div>

            <div
              class="w-8 h-8 rounded-full bg-gray-600 flex items-center justify-center flex-shrink-0"
            >
              <svg class="w-5 h-5 text-gray-300" fill="currentColor" viewBox="0 0 20 20">
                <path
                  fill-rule="evenodd"
                  d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z"
                  clip-rule="evenodd"
                />
              </svg>
            </div>
          </div>
        </div>
      </ng-container>

      <div *ngIf="message.type === 'JOIN'" class="system-notification">
        {{ message.sender }} joined the chat
      </div>

      <div *ngIf="message.type === 'LEAVE'" class="system-notification">
        {{ message.sender }} left the chat
      </div>
    </div>
  </div>

  <div class="border-t border-gray-700 bg-gray-800 w-full p-2 flex items-center">
    <input
      type="text"
      [(ngModel)]="newMessage"
      placeholder="Type a message..."
      (keyup.enter)="sendMessage()"
      class="px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 w-full focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent"
    />
    <button
      class="p-2 mx-4 bg-indigo-600 hover:bg-indigo-700 rounded-full transition-colors min-w-[120px] text-white font-semibold"
      (click)="sendMessage()"
      [disabled]="!newMessage.trim()"
    >
      Send
    </button>
  </div>
</div>
